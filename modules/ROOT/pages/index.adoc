= Общее описание системы

.{dv} даёт возможность:
* Создавать и хранить документы в электронном виде.
* Создавать задания для сотрудников, контролировать исполнение заданий.
* Согласовывать документы.
* Разграничивать права доступа к объектам с использованием нескольких моделей безопасности.
* Автоматизировать процессы электронного документооборота и бизнес-процессы организации.
* Протоколировать работу пользователей.
* Настраивать работу объектов и процессов без программирования.
* Работать с открытым API.

// В зависимости от типа выполняемых функций модули делятся на базовые и дополнительные.

== Общая структура {dv}

Система {dv} обладает классической трёхуровневой архитектурой, включающей: клиентское приложение, сервер и базу данных.

.Трёхуровневая архитектура {dv}
image::three-lvl-arch.png[Трёхуровневая архитектура {dv}]
//include::example$three-lvl-arch.adoc[]

=== Клиентское приложение

.Для работы с системой {dv} пользователь может использовать:
* Стандартные клиенты: {wincl} или {wc}.
* Специальные клиенты: Почтовый клиент -- позволяет выполнять задания с помощью почтовой программы и др.

=== Сервер {dv}

.Сервер {dv} реализован в следующем виде:
* Веб-сервис -- функционирует в среде выполнения ASP.NET 6.0. Веб-сервис предоставляет доступ клиентам по протоколу `SOAP`, а также реализует стиль взаимодействия `REST`.

.Также на уровне сервера работают:
* Служба СУБП (система управления бизнес-процессами).
* Сервис полнотекстового индексирования -- обеспечивает возможность использования полнотекстового поиска по данным.
* Файловый сервис -- выполняет отложенные операции удаления бинарных данных файлов из внешних хранилищ и перемещает данные между хранилищами.

Сервер {dv}, СУБП и Сервис полнотекстового индексирования могут масштабироваться. Для этого несколько элементов одного типа объединяются в кластер.

.Кластер сервисов {dv}
image::dv-cluster.png[Кластер сервисов {dv}]
//include::example$dv-cluster.adoc[]

=== База данных

Основным хранилищем данных в {dv} является база данных. В качестве СУБД поддерживаются Microsoft SQL или {pgsql}. В более сложных конфигурациях могут быть добавлены xref:dev@platform:console:redis-cache.adoc[кэш-сервер Redis], а также выделенные xref:dev@platform:console:storage.adoc[хранилища для бинарных данных] (содержимого) файлов.

.Конфигурация {dv} с внешними хранилищами и Redis
image::redis-storage.png[Конфигурация {dv} с внешними хранилищами и Redis]
//include::example$redis-storage.adoc[]

== Основные объекты системы

Основными объектами {dv} являются карточки и файлы.

.Схема взаимодействия основных элементов Системы
image::coop.png[Схема взаимодействия основных элементов Системы]
//include::example$coop.adoc[]

=== Карточки

Карточки -- элементы систем, предназначенные для упорядоченного хранения сведений о внешних объектах и процессах.

Карточка {dv} включает две составляющие: данные и пользовательский интерфейс. Пользовательский интерфейс является необязательным.

Данные карточки представляют собой набор простейших элементов -- _полей_, сгруппированных в _секции_.

Поле является элементарной единицей хранения данных в {dv}. Тип информации, которая может храниться в поле, определяется типом поля. Например, есть типы полей для хранения строковых или числовых данных, даты и времени, значения `Да/Нет` и др.

.Также настройки полей могут устанавливать другие ограничения для хранимой информации:
- Максимальный размер для текстовых данных.
- Обязательное наличие данных в поле при сохранении карточки.

Специальные типы полей предназначены для хранения ссылки на карточки или данные карточек -- _ссылочные поля_.

==== Виды секций

С помощью секций формируются группы полей, к которым применяются особые правила секции. Основным правилом является тип секции, который определяет структуру полей секции:

Плоская::
В секции может храниться одна строка с данными полей секции.
+
.Плоская секция
image::flat-section.png[Плоская секция]
//include::example$flat-section.adoc[]
+
Коллекционная (табличная)::
В секции может храниться одна или несколько отдельных строк с данными полей секции.
+
.Вид такбличной секции
image::table-section.png[Вид такбличной секции]
//include::example$table-section.adoc[]
+
Иерархическая (древовидная)::
В секции может храниться одна или несколько строк с данными полей секции, отдельные строки могут являться подстроками других строк.
+
.Древовидная секция
image::tree-section.png[Древовидная секция]
//include::example$tree-section.adoc[]
+
В свою очередь секция может являться подчинённой по отношению к другой секции.
+
.Подчинённая секция
image::subsection.png[Подчинённая секция]
//include::example$subsection.adoc[]
+
Перечень и параметры секций и полей карточки формируют её описание -- _тип карточки_ (в терминах {dv}). Карточки, созданные по описанию, называются _экземплярами карточек_.

NOTE: Описание схем стандартных карточек {dv} приведено в документации "xref:schemas::index.adoc[Описание полей стандартных карточек {dv}]".

Физически экземпляры карточек хранятся в БД {dv} в таблицах `dvtable_\{ID-секции}`. В каждой таблице хранятся данные одной секции всех карточек одного типа. Описание, общая и системная информация о карточке хранятся в отдельных таблицах: `dvsys_instances`, `dvsys_instances_date` и некоторых других.

Описание таблиц БД {dv} приведено в пункте xref:db-tables.adoc[].

.База данных и карточки
image::db-and-cards.png[База данных и карточки]
//include::example$db-and-cards.adoc[tags=class]

Схемы карточек в формате XML хранятся в таблице `dvsys_carddefs`.

Частным случаем карточки является _справочник_ -- тип карточки, у которой может быть только один экземпляр. Данные справочников, как правило, используются в других карточках через _ссылочные поля_.

=== Библиотеки карточек

_Библиотека карточек_ -- коллекция типов карточек, необходимая для загрузки карточек в {dv} и их обновления. Как правило, в библиотеку включаются все карточки одного модуля {dv}.

=== Файлы

В системе {dv} файл представлен на двух уровнях:

. На более низком: бинарные данные файла и его атрибуты. Атрибуты включают: размер, дата создания и изменения, признаки архивирования и предварительного удаления и другие.
. На более высоком: _Карточка файла с версиями_. Такая карточка содержит ссылки на версии файла, а именно на бинарные данные разных версий, номера версий, комментарии к версиям и данные авторов версий.

_Карточка файла с версиями_ используется для хранения файлов, прикрепляемых к карточкам {dv}. В системных целях {dv} работает непосредственно с файлами.

Карточки файлов с версиями и атрибуты файлов хранятся в БД {dv}, а бинарные данные могут храниться в БД или в отдельном хранилище вне БД {dv}. Более подробно внешнее хранение бинарных данных рассмотрено в пункте xref:binary-storage.adoc[].

.Структура файлов
image::files-structure.png[Структура файлов]
